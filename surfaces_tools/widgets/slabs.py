import ase
import numpy as np
from ase.build import sort

# Au lattice param used: 4.1691
# dimensions of a rectangular unit cell of Au with z pointing in (111) direction
au_x = 2.94799888  # a/sqrt(2)
au_y = 5.10608384  # a*sqrt(3/2)

# Ag lattice param used: 4.10669535119
# dimensions of a rectangular unit cell of Ag with z pointing in (111) direction
ag_x = 2.90387213  # a/sqrt(2)
ag_y = 5.02965407  # a*sqrt(3/2)

# Cu lattice param used: 3.60103410694
# dimensions of a rectangular unit cell of Cu with z pointing in (111) direction
cu_x = 2.54631564  # a/sqrt(2)
cu_y = 4.41034805  # a*sqrt(3/2)

# draft of Au(111) herringbone slab
# dimensions of a rectangular unit cell of Au(111) with z pointing in (111) direction
au_h_x = au_x * 22
au_h_y = au_y  # 22 x sqrt(3)
au_h_top = np.array(
    [
        [0.01701210, 0.04285391, 18.08960579],
        [2.96603080, 0.03312577, 18.09356958],
        [5.91151364, 0.02573939, 18.08761652],
        [8.85836708, 0.02413557, 18.08068253],
        [11.80238894, 0.02326483, 18.07660551],
        [14.74837119, 0.02823777, 18.07677961],
        [17.69312175, 0.03012032, 18.08152859],
        [20.63902018, 0.03460213, 18.08791874],
        [23.58634015, 0.03822919, 18.09205779],
        [26.53825671, 0.04288893, 18.09030357],
        [29.49441527, 0.04324161, 18.09050566],
        [32.44506365, 0.03822036, 18.09185473],
        [35.39153987, 0.03562650, 18.08893717],
        [38.33500235, 0.03092218, 18.08186901],
        [41.28022738, 0.02897981, 18.07770002],
        [44.22345666, 0.02386124, 18.07710219],
        [47.16890048, 0.02440937, 18.07981466],
        [50.11336390, 0.02387037, 18.08612075],
        [53.06011883, 0.03113104, 18.09200241],
        [56.00695092, 0.03966272, 18.09155241],
        [58.96072341, 0.05038724, 18.08297184],
        [61.91868250, 0.05119791, 18.08251578],
        [1.49163904, 2.58982972, 18.09296189],
        [4.43937034, 2.58251835, 18.09142275],
        [7.38481013, 2.57729169, 18.08397444],
        [10.33012740, 2.57670213, 18.07833277],
        [13.27566466, 2.57900853, 18.07660206],
        [16.22059939, 2.58165022, 18.07908866],
        [19.16634062, 2.58640466, 18.08494607],
        [22.11152341, 2.58823386, 18.09112051],
        [25.06192902, 2.59486277, 18.09152435],
        [28.01559130, 2.59550372, 18.08986806],
        [30.97049094, 2.59494958, 18.09153994],
        [33.91834053, 2.58900849, 18.09114392],
        [36.86361530, 2.58675426, 18.08510036],
        [39.80757019, 2.58276184, 18.07944161],
        [42.75153773, 2.57924469, 18.07657572],
        [45.69625841, 2.57687192, 18.07829275],
        [48.64092128, 2.57626760, 18.08280684],
        [51.58672293, 2.58049063, 18.08962004],
        [54.53267802, 2.58730315, 18.09336685],
        [57.48372249, 2.59971542, 18.08742216],
        [60.43929382, 2.60421631, 18.08141187],
        [63.39710321, 2.60216986, 18.08558243],
        [1.49814004, 0.91984682, 20.49300623],
        [4.44246454, 0.91291127, 20.49497643],
        [7.37870384, 0.91192711, 20.48821757],
        [10.30925613, 0.91394851, 20.48394323],
        [13.23865920, 0.91947377, 20.48163856],
        [16.17117146, 0.92126961, 20.48464112],
        [19.11133213, 0.92050110, 20.48941539],
        [22.06668313, 0.91227190, 20.49450205],
        [25.03731462, 0.90249725, 20.48912007],
        [28.02119367, 0.89905285, 20.48409264],
        [31.00459319, 0.90436303, 20.48958352],
        [33.97635530, 0.91609667, 20.49549616],
        [36.93080245, 0.92352150, 20.49105390],
        [39.87188226, 0.92553327, 20.48538568],
        [42.80372055, 0.92190764, 20.48442301],
        [45.73140928, 0.91769500, 20.48456109],
        [48.65973643, 0.91299549, 20.48895594],
        [51.59279163, 0.91403128, 20.49346985],
        [54.53472862, 0.91869120, 20.49562599],
        [57.48476896, 0.92668140, 20.48141517],
        [60.44222645, 0.93046293, 20.47130410],
        [63.40051819, 0.92755776, 20.47779924],
        [0.02266792, 3.47690335, 20.48691987],
        [2.97127964, 3.46912719, 20.49559412],
        [5.91163945, 3.46493686, 20.49277545],
        [8.84395513, 3.46545678, 20.48585682],
        [11.77387322, 3.46995239, 20.48314298],
        [14.70396703, 3.47388570, 20.48243317],
        [17.63973684, 3.47508527, 20.48739059],
        [20.58698407, 3.47004561, 20.49295687],
        [23.54978757, 3.46022646, 20.49301028],
        [26.52807226, 3.45227318, 20.48584158],
        [29.51286876, 3.45387216, 20.48517934],
        [32.49234984, 3.46278596, 20.49424451],
        [35.45489398, 3.47365566, 20.49318253],
        [38.40250946, 3.47838287, 20.48826237],
        [41.33781128, 3.47711861, 20.48375087],
        [44.26738874, 3.47327863, 20.48439111],
        [47.19492153, 3.46797651, 20.48549718],
        [50.12545962, 3.46647633, 20.49150741],
        [53.06240152, 3.46861044, 20.49530749],
        [56.00877266, 3.47619607, 20.49018239],
        [58.96308517, 3.48232652, 20.47474119],
        [61.92169991, 3.48329612, 20.47247449],
        [-0.16161431, 1.91795768, 23.00621320],
        [2.65667351, 1.98268247, 23.04000514],
        [5.47530595, 2.05167339, 23.05533815],
        [8.29645854, 2.10891134, 23.05812518],
        [11.12177538, 2.15813811, 23.05676682],
        [13.94892201, 2.20369540, 23.05678701],
        [16.77323597, 2.25062033, 23.05993690],
        [19.59218559, 2.30812628, 23.05883278],
        [22.40433467, 2.37503916, 23.04816064],
        [25.21374417, 2.44026396, 23.01812023],
        [28.02530635, 2.46866243, 22.99948713],
        [30.83714603, 2.44324904, 23.01742105],
        [33.64686133, 2.38112341, 23.04690697],
        [36.45925382, 2.31416823, 23.05949753],
        [39.27839960, 2.25835264, 23.05972572],
        [42.10338134, 2.21118590, 23.05860542],
        [44.93248211, 2.16795263, 23.05750524],
        [47.75977197, 2.12042096, 23.05721074],
        [50.58304056, 2.06594326, 23.05634131],
        [53.40217227, 1.99949678, 23.04467722],
        [56.22077048, 1.93145058, 23.01500244],
        [59.04385101, 1.88450706, 22.97882886],
        [61.87058186, 1.87875983, 22.97505129],
        [1.24801360, 4.50190543, 23.02595412],
        [4.06566336, 4.57131104, 23.04975381],
        [6.88538272, 4.63475904, 23.05734413],
        [9.70904794, 4.68758957, 23.05726230],
        [12.53583143, 4.73387650, 23.05658444],
        [15.36224017, 4.77994787, 23.05847118],
        [18.18385496, 4.83086880, 23.06053339],
        [20.99920585, 4.89369598, 23.05648206],
        [23.80912808, 4.96319374, 23.03445637],
        [26.61926696, 5.01383252, 23.00502336],
        [29.43187545, 5.01599200, 23.00487931],
        [32.24220881, 4.96702305, 23.03388486],
        [35.05282024, 4.90013908, 23.05592841],
        [37.86815994, 4.83725642, 23.06008968],
        [40.69067026, 4.78747341, 23.05949848],
        [43.51809874, 4.74251241, 23.05803054],
        [46.34680399, 4.69774911, 23.05800469],
        [49.17237506, 4.64763696, 23.05862281],
        [51.99309561, 4.58672768, 23.05260057],
        [54.81176520, 4.51788669, 23.03335193],
        [57.63193527, 4.45647931, 22.99548118],
        [60.45788061, 4.42922293, 22.97282348],
        [63.28371178, 4.44677947, 22.98739625],
    ]
)

au_h_1 = np.array(
    [
        [-0.00000000, 1.70202795, 0.0],
        [2.94799888, 1.70202795, 0.0],
        [5.89599776, 1.70202795, 0.0],
        [8.84399664, 1.70202795, 0.0],
        [11.79199552, 1.70202795, 0.0],
        [14.73999440, 1.70202795, 0.0],
        [17.68799328, 1.70202795, 0.0],
        [20.63599216, 1.70202795, 0.0],
        [23.58399104, 1.70202795, 0.0],
        [26.53198992, 1.70202795, 0.0],
        [29.47998880, 1.70202795, 0.0],
        [32.42798768, 1.70202795, 0.0],
        [35.37598656, 1.70202795, 0.0],
        [38.32398544, 1.70202795, 0.0],
        [41.27198432, 1.70202795, 0.0],
        [44.21998320, 1.70202795, 0.0],
        [47.16798208, 1.70202795, 0.0],
        [50.11598096, 1.70202795, 0.0],
        [53.06397984, 1.70202795, 0.0],
        [56.01197872, 1.70202795, 0.0],
        [58.95997760, 1.70202795, 0.0],
        [61.90797648, 1.70202795, 0.0],
        [1.47399944, 4.25506987, 0.0],
        [4.42199832, 4.25506987, 0.0],
        [7.36999720, 4.25506987, 0.0],
        [10.31799608, 4.25506987, 0.0],
        [13.26599496, 4.25506987, 0.0],
        [16.21399384, 4.25506987, 0.0],
        [19.16199272, 4.25506987, 0.0],
        [22.10999160, 4.25506987, 0.0],
        [25.05799048, 4.25506987, 0.0],
        [28.00598936, 4.25506987, 0.0],
        [30.95398824, 4.25506987, 0.0],
        [33.90198712, 4.25506987, 0.0],
        [36.84998600, 4.25506987, 0.0],
        [39.79798488, 4.25506987, 0.0],
        [42.74598376, 4.25506987, 0.0],
        [45.69398264, 4.25506987, 0.0],
        [48.64198152, 4.25506987, 0.0],
        [51.58998040, 4.25506987, 0.0],
        [54.53797928, 4.25506987, 0.0],
        [57.48597816, 4.25506987, 0.0],
        [60.43397704, 4.25506987, 0.0],
        [63.38197592, 4.25506987, 0.0],
    ]
)
au_h_2 = np.array(
    [
        [1.47399944, 0.85101397, 0.0],
        [4.42199832, 0.85101397, 0.0],
        [7.36999720, 0.85101397, 0.0],
        [10.31799608, 0.85101397, 0.0],
        [13.26599496, 0.85101397, 0.0],
        [16.21399384, 0.85101397, 0.0],
        [19.16199272, 0.85101397, 0.0],
        [22.10999160, 0.85101397, 0.0],
        [25.05799048, 0.85101397, 0.0],
        [28.00598936, 0.85101397, 0.0],
        [30.95398824, 0.85101397, 0.0],
        [33.90198712, 0.85101397, 0.0],
        [36.84998600, 0.85101397, 0.0],
        [39.79798488, 0.85101397, 0.0],
        [42.74598376, 0.85101397, 0.0],
        [45.69398264, 0.85101397, 0.0],
        [48.64198152, 0.85101397, 0.0],
        [51.58998040, 0.85101397, 0.0],
        [54.53797928, 0.85101397, 0.0],
        [57.48597816, 0.85101397, 0.0],
        [60.43397704, 0.85101397, 0.0],
        [63.38197592, 0.85101397, 0.0],
        [0.00000000, 3.40405590, 0.0],
        [2.94799888, 3.40405590, 0.0],
        [5.89599776, 3.40405590, 0.0],
        [8.84399664, 3.40405590, 0.0],
        [11.79199552, 3.40405590, 0.0],
        [14.73999440, 3.40405590, 0.0],
        [17.68799328, 3.40405590, 0.0],
        [20.63599216, 3.40405590, 0.0],
        [23.58399104, 3.40405590, 0.0],
        [26.53198992, 3.40405590, 0.0],
        [29.47998880, 3.40405590, 0.0],
        [32.42798768, 3.40405590, 0.0],
        [35.37598656, 3.40405590, 0.0],
        [38.32398544, 3.40405590, 0.0],
        [41.27198432, 3.40405590, 0.0],
        [44.21998320, 3.40405590, 0.0],
        [47.16798208, 3.40405590, 0.0],
        [50.11598096, 3.40405590, 0.0],
        [53.06397984, 3.40405590, 0.0],
        [56.01197872, 3.40405590, 0.0],
        [58.95997760, 3.40405590, 0.0],
        [61.90797648, 3.40405590, 0.0],
    ]
)
au_h_3 = np.array(
    [
        [0.00000000, -0.00000000, 0.0],
        [2.94799888, 0.00000000, 0.0],
        [5.89599776, 0.00000000, 0.0],
        [8.84399664, -0.00000000, 0.0],
        [11.79199552, 0.00000000, 0.0],
        [14.73999440, 0.00000000, 0.0],
        [17.68799328, -0.00000000, 0.0],
        [20.63599216, 0.00000000, 0.0],
        [23.58399104, 0.00000000, 0.0],
        [26.53198992, -0.00000000, 0.0],
        [29.47998880, -0.00000000, 0.0],
        [32.42798768, 0.00000000, 0.0],
        [35.37598656, -0.00000000, 0.0],
        [38.32398544, 0.00000000, 0.0],
        [41.27198432, 0.00000000, 0.0],
        [44.21998320, 0.00000000, 0.0],
        [47.16798208, 0.00000000, 0.0],
        [50.11598096, -0.00000000, 0.0],
        [53.06397984, 0.00000000, 0.0],
        [56.01197872, 0.00000000, 0.0],
        [58.95997760, -0.00000000, 0.0],
        [61.90797648, 0.00000000, 0.0],
        [1.47399944, 2.55304192, 0.0],
        [4.42199832, 2.55304192, 0.0],
        [7.36999720, 2.55304192, 0.0],
        [10.31799608, 2.55304192, 0.0],
        [13.26599496, 2.55304192, 0.0],
        [16.21399384, 2.55304192, 0.0],
        [19.16199272, 2.55304192, 0.0],
        [22.10999160, 2.55304192, 0.0],
        [25.05799048, 2.55304192, 0.0],
        [28.00598936, 2.55304192, 0.0],
        [30.95398824, 2.55304192, 0.0],
        [33.90198712, 2.55304192, 0.0],
        [36.84998600, 2.55304192, 0.0],
        [39.79798488, 2.55304192, 0.0],
        [42.74598376, 2.55304192, 0.0],
        [45.69398264, 2.55304192, 0.0],
        [48.64198152, 2.55304192, 0.0],
        [51.58998040, 2.55304192, 0.0],
        [54.53797928, 2.55304192, 0.0],
        [57.48597816, 2.55304192, 0.0],
        [60.43397704, 2.55304192, 0.0],
        [63.38197592, 2.55304192, 0.0],
    ],
)
au_h = {1: au_h_1, 2: au_h_2, 3: au_h_3}
# And the x,y coordinates of the Au,Ag,Cu atoms in exact symmetric positions of the three layers of the unit cell
au_exact_xz = np.array(
    [
        [[0.00000000, 1.70202795], [1.47399944, 4.25506987]],
        [[0.00000000, 0.00000000], [1.47399944, 2.55304192]],
        [[0.00000000, 3.40405590], [1.47399944, 0.85101397]],
    ]
)

dz_au_bulk = 2.40703101  # Distance between bulk Au layers
dz_au_h = 0.86519004  # Distance between Au and H layer
dz_au_1_2 = 2.45156905  # Distance between Au top layer and 2nd layer
dz_au_2_3 = 2.39444938  # Distance between Au 2nd layer and 3rd layer (bulk)


# And the x,y coordinates of the Au,Ag,Cu atoms in exact symmetric positions of the three layers of the unit cell
ag_exact_xz = au_exact_xz * 4.10669535119 / 4.1691

dz_ag_bulk = dz_au_bulk * 4.10669535119 / 4.1691  # Distance between bulk Ag layers
dz_ag_h = 0.85106910  # Distance between Ag and H layer
dz_ag_1_2 = 2.35156179  # Distance between Ag top layer and 2nd layer
dz_ag_2_3 = 2.37580264  # Distance between Ag 2nd layer and 3rd layer (bulk)


# And the x,y coordinates of the Au,Ag,Cu atoms in exact symmetric positions of the three layers of the unit cell
cu_exact_xz = au_exact_xz * 3.60103410694 / 4.1691

dz_cu_bulk = dz_au_bulk * 3.60103410694 / 4.1691  # Distance between bulk Cu layers
dz_cu_h = 0.86502011  # Distance between Cu and H layer
dz_cu_1_2 = 2.06853511  # Distance between Cu top layer and 2nd layer
dz_cu_2_3 = 2.08397214  # Distance between Cu 2nd layer and 3rd layer (bulk)

h_bn_x = 2.510999063
h_bn_y = 4.349177955
h_bn_z = 6.842897412
h_bn_unit = [
    ["B", 0.5, 1.0 / 6.0, 0.0],
    ["N", 0.0, 1.0 / 3.0, 0.0],
    ["B", 0.0, 2.0 / 3.0, 0.0],
    ["N", 0.5, 5.0 / 6.0, 0.0],
    ["N", 0.5, 1.0 / 6.0, 0.5],
    ["B", 0.0, 1.0 / 3.0, 0.5],
    ["N", 0.0, 2.0 / 3.0, 0.5],
    ["B", 0.5, 5.0 / 6.0, 0.5],
]
PdGa_Lx = 6.94998812643203
PdGa_Ly = 12.0377325469807
PdGa_Lz = 8.511962399582
Pd3_A_unit = [
    ["Pd", 3.474994063216, 2.006288817622, 0.000000000000],
    ["Pd", -0.000000000000, 8.025155270489, 0.000000000000],
    ["Ga", 5.212491094824, 0.257607487340, 0.763806284236],
    ["Ga", 1.091843182881, 1.375912802281, 0.763806284236],
    ["Ga", 4.120647808380, 4.385346118402, 0.763806284236],
    ["Ga", 1.737497031608, 6.276473446922, 0.763806284236],
    ["Ga", 4.566837349660, 7.394779255147, 0.763806284236],
    ["Ga", 0.645653900508, 10.404212391892, 0.763806284236],
    ["Pd", 5.962394976715, 2.576476048253, 1.612733512153],
    ["Pd", 1.737497031608, 3.875347313730, 1.612733512153],
    ["Pd", 6.200084244541, 5.585909184998, 1.612733512153],
    ["Pd", 2.487400706374, 8.595341962991, 1.612733512153],
    ["Pd", 5.212491094824, 9.894213587220, 1.612733512153],
    ["Pd", 2.725090388450, 11.604775099736, 1.612733512153],
    ["Ga", 3.474994063216, 2.006288817622, 2.546779262310],
    ["Ga", -0.000000000000, 8.025155270489, 2.546779262310],
    ["Pd", 3.474994063216, 6.018866273490, 2.837320799861],
    ["Pd", -0.000000000000, 12.037732546981, 2.837320799861],
    ["Ga", 0.645653900508, 2.379057121404, 3.601127084096],
    ["Ga", 5.212491094824, 4.270185167428, 3.601127084096],
    ["Ga", 1.091843182881, 5.388490258149, 3.601127084096],
    ["Ga", 4.120647808380, 8.397923394894, 3.601127084096],
    ["Ga", 1.737497031608, 10.289051440918, 3.601127084096],
    ["Ga", 4.566837349660, 11.407356531639, 3.601127084096],
    ["Pd", 2.487400706374, 0.570187275475, 4.450054312013],
    ["Pd", 5.212491094824, 1.869058675484, 4.450054312013],
    ["Pd", 2.725090388450, 3.579620546752, 4.450054312013],
    ["Pd", 5.962394976715, 6.589053683497, 4.450054312013],
    ["Pd", 1.737497031608, 7.887924590222, 4.450054312013],
    ["Pd", 6.200084244541, 9.598486820242, 4.450054312013],
    ["Ga", 3.474994063216, 6.018866273490, 5.384100062170],
    ["Ga", -0.000000000000, 12.037732546981, 5.384100062170],
    ["Pd", -0.000000000000, 4.012577635244, 5.674641599721],
    ["Pd", 3.474994063216, 10.031443549982, 5.674641599721],
    ["Ga", 4.120647808380, 0.372768460736, 6.438447883957],
    ["Ga", 1.737497031608, 2.263896170430, 6.438447883957],
    ["Ga", 4.566837349660, 3.382201619903, 6.438447883957],
    ["Ga", 0.645653900508, 6.391634397896, 6.438447883957],
    ["Ga", 5.212491094824, 8.282762443920, 6.438447883957],
    ["Ga", 1.091843182881, 9.401067534641, 6.438447883957],
    ["Pd", 6.200084244541, 1.573331729130, 7.287375111874],
    ["Pd", 2.487400706374, 4.582764686499, 7.287375111874],
    ["Pd", 5.212491094824, 5.881635951976, 7.287375111874],
    ["Pd", 2.725090388450, 7.592197823244, 7.287375111874],
    ["Pd", 5.962394976715, 10.601630959989, 7.287375111874],
    ["Pd", 1.737497031608, 11.900502584218, 7.287375111874],
    ["Ga", 0.000000000000, 4.012577635244, 8.221420862031],
    ["Ga", 3.474994063216, 10.031443549982, 8.221420862031],
]
Pd3_A_top = [
    ["Pd", 3.474994063216, 2.006288817622, 8.511962399582],
    ["Pd", 0.000000000000, 8.025155270489, 8.511962399582],
    ["Ga", 5.212491094824, 0.257607487340, 9.275768683818],
    ["Ga", 1.091843182881, 1.375912802281, 9.275768683818],
    ["Ga", 4.120647808380, 4.385346118402, 9.275768683818],
    ["Ga", 1.737497031608, 6.276473446922, 9.275768683818],
    ["Ga", 4.566837349660, 7.394779255147, 9.275768683818],
    ["Ga", 0.645653900508, 10.404212391892, 9.275768683818],
    ["Pd", 5.962394976715, 2.576476048253, 10.124695911735],
    ["Pd", 1.737497031608, 3.875347313730, 10.124695911735],
    ["Pd", 6.200084244541, 5.585909184998, 10.124695911735],
    ["Pd", 2.487400706374, 8.595341962991, 10.124695911735],
    ["Pd", 5.212491094824, 9.894213587220, 10.124695911735],
    ["Pd", 2.725090388450, 11.604775099736, 10.124695911735],
    ["Ga", 3.474994063216, 2.006288817622, 11.058741661892],
    ["Ga", 0.000000000000, 8.025155270489, 11.058741661892],
    ["Pd", 3.474994063216, 6.018866273490, 11.349283199443],
    ["Pd", 0.000000000000, 12.037732546981, 11.349283199443],
    ["Ga", 0.645653900508, 2.379057121404, 12.113090694399],
    ["Ga", 5.212491094824, 4.270185167428, 12.113090694399],
    ["Ga", 1.091843182881, 5.388490258149, 12.113090694399],
    ["Ga", 4.120647808380, 8.397923394894, 12.113090694399],
    ["Ga", 1.737497031608, 10.289051440918, 12.113090694399],
    ["Ga", 4.566837349660, 11.407356531639, 12.113090694399],
    ["Pd", 2.487400706374, 0.570187275475, 12.962016711596],
    ["Pd", 5.212491094824, 1.869058675484, 12.962016711596],
    ["Pd", 2.725090388450, 3.579620546752, 12.962016711596],
    ["Pd", 5.962394976715, 6.589053683497, 12.962016711596],
    ["Pd", 1.737497031608, 7.887924590222, 12.962016711596],
    ["Pd", 6.200084244541, 9.598486820242, 12.962016711596],
    ["Ga", 3.474994063216, 6.018866273490, 13.896061251032],
    ["Ga", -0.000000000000, 12.037732546981, 13.896061251032],
    ["Pd", 0.000000000000, 4.012577635244, 14.186602788582],
    ["Pd", 3.474994063216, 10.031443549982, 14.186602788582],
    ["Ga", 4.120647808380, 0.372768460736, 14.950410283539],
    ["Ga", 1.737497031608, 2.263896170430, 14.950410283539],
    ["Ga", 4.566837349660, 3.382201619903, 14.950410283539],
    ["Ga", 0.645653900508, 6.391634397896, 14.950410283539],
    ["Ga", 5.212491094824, 8.282762443920, 14.950410283539],
    ["Ga", 1.091843182881, 9.401067534641, 14.950410283539],
    ["Pd", 6.200084244541, 1.573331729130, 15.799336300735],
    ["Pd", 2.487400706374, 4.582764686499, 15.799336300735],
    ["Pd", 5.212491094824, 5.881635951976, 15.799336300735],
    ["Pd", 2.725090388450, 7.592197823244, 15.799336300735],
    ["Pd", 5.962394976715, 10.601630959989, 15.799336300735],
    ["Pd", 1.737497031608, 11.900502584218, 15.799336300735],
]

Pd1_A_unit = [
    ["Pd", 1.737497031608, 0.137230153350, 0.000000000000],
    ["Pd", 5.962394976715, 1.436101497303, 0.000000000000],
    ["Pd", 2.725090388450, 4.445534723737, 0.000000000000],
    ["Pd", 5.212491094824, 6.156096236253, 0.000000000000],
    ["Pd", 2.487400706374, 7.454967860482, 0.000000000000],
    ["Pd", 6.200084244541, 10.464400997227, 0.000000000000],
    ["Ga", 1.091843182881, 2.636664653587, 0.848926026455],
    ["Ga", 5.212491094824, 3.754970103061, 0.848926026455],
    ["Ga", 0.645653900508, 5.646097790333, 0.848926026455],
    ["Ga", 4.566837349660, 8.655531285830, 0.848926026455],
    ["Ga", 1.737497031608, 9.773836376551, 0.848926026455],
    ["Ga", 4.120647808380, 11.664964422575, 0.848926026455],
    ["Pd", 3.474994063216, 2.006288817622, 1.612734285136],
    ["Pd", 0.000000000000, 8.025155270489, 1.612734285136],
    ["Ga", 3.474994063216, 6.018866273490, 1.903275110736],
    ["Ga", -0.000000000000, 12.037732546981, 1.903275110736],
    ["Pd", 6.200084244541, 2.439245906114, 2.837321336552],
    ["Pd", 1.737497031608, 4.149807598007, 2.837321336552],
    ["Pd", 5.962394976715, 5.448678863483, 2.837321336552],
    ["Pd", 2.725090388450, 8.458112000229, 2.837321336552],
    ["Pd", 5.212491094824, 10.168674230249, 2.837321336552],
    ["Pd", 2.487400706374, 11.467545136974, 2.837321336552],
    ["Ga", 4.566837349660, 0.630375925653, 3.686247363006],
    ["Ga", 1.737497031608, 1.748681285438, 3.686247363006],
    ["Ga", 4.120647808380, 3.639809152087, 3.686247363006],
    ["Ga", 1.091843182881, 6.649242288832, 3.686247363006],
    ["Ga", 5.212491094824, 7.767547379553, 3.686247363006],
    ["Ga", 0.645653900508, 9.658675425577, 3.686247363006],
    ["Pd", 3.474994063216, 6.018866273490, 4.450053190099],
    ["Pd", -0.000000000000, 12.037732546981, 4.450053190099],
    ["Ga", -0.000000000000, 4.012577635244, 4.740596447288],
    ["Ga", 3.474994063216, 10.031443549982, 4.740596447288],
    ["Pd", 2.725090388450, 0.432957133336, 5.674642673104],
    ["Pd", 5.212491094824, 2.143518959761, 5.674642673104],
    ["Pd", 2.487400706374, 3.442390225237, 5.674642673104],
    ["Pd", 6.200084244541, 6.451823720735, 5.674642673104],
    ["Pd", 1.737497031608, 8.162385233251, 5.674642673104],
    ["Pd", 5.962394976715, 9.461256857480, 5.674642673104],
    ["Ga", 0.645653900508, 1.633520334464, 6.523568699558],
    ["Ga", 4.566837349660, 4.642953291833, 6.523568699558],
    ["Ga", 1.737497031608, 5.761258741307, 6.523568699558],
    ["Ga", 4.120647808380, 7.652386428579, 6.523568699558],
    ["Ga", 1.091843182881, 10.661819565324, 6.523568699558],
    ["Ga", 5.212491094824, 11.780125373549, 6.523568699558],
    ["Pd", -0.000000000000, 4.012577635244, 7.287374526650],
    ["Pd", 3.474994063216, 10.031443549982, 7.287374526650],
    ["Ga", 3.474994063216, 2.006288817622, 7.577917783840],
    ["Ga", 0.000000000000, 8.025155270489, 7.577917783840],
]

Pd1_A_top = [
    ["Pd", 1.737497031608, 0.137230153350, 8.511961578067],
    ["Pd", 5.962394976715, 1.436101497303, 8.511961578067],
    ["Pd", 2.725090388450, 4.445534723737, 8.511961578067],
    ["Pd", 5.212491094824, 6.156096236253, 8.511961578067],
    ["Pd", 2.487400706374, 7.454967860482, 8.511961578067],
    ["Pd", 6.200084244541, 10.464400997227, 8.511961578067],
    ["Ga", 1.091843182881, 2.636664653587, 9.360890036110],
    ["Ga", 5.212491094824, 3.754970103061, 9.360890036110],
    ["Ga", 0.645653900508, 5.646097790333, 9.360890036110],
    ["Ga", 4.566837349660, 8.655531285830, 9.360890036110],
    ["Ga", 1.737497031608, 9.773836376551, 9.360890036110],
    ["Ga", 4.120647808380, 11.664964422575, 9.360890036110],
    ["Pd", 3.474994063216, 2.006288817622, 10.124695863202],
    ["Pd", 0.000000000000, 8.025155270489, 10.124695863202],
    ["Ga", 3.474994063216, 6.018866273490, 10.415236688803],
    ["Ga", -0.000000000000, 12.037732546981, 10.415236688803],
    ["Pd", 6.200084244541, 2.439245906114, 11.349282914619],
    ["Pd", 1.737497031608, 4.149807598007, 11.349282914619],
    ["Pd", 5.962394976715, 5.448678863483, 11.349282914619],
    ["Pd", 2.725090388450, 8.458112000229, 11.349282914619],
    ["Pd", 5.212491094824, 10.168674230249, 11.349282914619],
    ["Pd", 2.487400706374, 11.467545136974, 11.349282914619],
    ["Ga", 4.566837349660, 0.630375925653, 12.198208941073],
    ["Ga", 1.737497031608, 1.748681285438, 12.198208941073],
    ["Ga", 4.120647808380, 3.639809152087, 12.198208941073],
    ["Ga", 1.091843182881, 6.649242288832, 12.198208941073],
    ["Ga", 5.212491094824, 7.767547379553, 12.198208941073],
    ["Ga", 0.645653900508, 9.658675425577, 12.198208941073],
    ["Pd", 3.474994063216, 6.018866273490, 12.962017199754],
    ["Pd", -0.000000000000, 12.037732546981, 12.962017199754],
    ["Ga", -0.000000000000, 4.012577635244, 13.252558025355],
    ["Ga", 3.474994063216, 10.031443549982, 13.252558025355],
    ["Pd", 2.725090388450, 0.432957133336, 14.186604251171],
    ["Pd", 5.212491094824, 2.143518959761, 14.186604251171],
    ["Pd", 2.487400706374, 3.442390225237, 14.186604251171],
    ["Pd", 6.200084244541, 6.451823720735, 14.186604251171],
    ["Pd", 1.737497031608, 8.162385233251, 14.186604251171],
    ["Pd", 5.962394976715, 9.461256857480, 14.186604251171],
    ["Ga", 0.645653900508, 1.633520334464, 15.035530277625],
    ["Ga", 4.566837349660, 4.642953291833, 15.035530277625],
    ["Ga", 1.737497031608, 5.761258741307, 15.035530277625],
    ["Ga", 4.120647808380, 7.652386428579, 15.035530277625],
    ["Ga", 1.091843182881, 10.661819565324, 15.035530277625],
    ["Ga", 5.212491094824, 11.780125373549, 15.035530277625],
    ["Pd", -0.000000000000, 4.012577635244, 15.799336104717],
    ["Pd", 3.474994063216, 10.031443549982, 15.799336104717],
]
PdGa_dict = {
    "PdGa_A_Pd1": {"bulk": Pd1_A_unit, "top": Pd1_A_top},
    "PdGa_A_Pd3": {"bulk": Pd3_A_unit, "top": Pd3_A_top},
}


# Cu(110)O-2x1
Cu_110_O_2x1_Lx = 2.54631563 * 2
Cu_110_O_2x1_Ly = 3.60103411
Cu_110_O_2x1_Lz = 2.54631563
Cu_110_O_2x1_bulk = [
    ["Cu", 0.0, 0.0, 0],
    ["Cu", 2.54631563, 0.0, 0],
    ["Cu", 1.273157815, 1.800517055, 1.273157815],
    ["Cu", 3.819473445, 1.800517055, 1.273157815],
]

Cu_110_O_2x1_top = [
    ["Cu", 0.0, 0.0, 2.54631563],
    ["Cu", 2.54631563, 0.0, 2.54631563],
    ["Cu", 1.273157815, 1.800517055, 3.81947344500],
    ["O", 1.273157815, 0, 3.81947344500],
]

# Au(110)2x1

Au_110_2x1_Lx = 8.3382
Au_110_2x1_Ly = 2.9482596
Au_110_2x1_Lz = 2.9482596
Au_110_2x1_bulk = [
    ["Au", 0.0, 0.0, 0],
    ["Au", 4.1691, 0.0, 0],
    ["Au", 2.08455, 1.474, 1.4741298],
    ["Au", 6.25365, 1.474, 1.4741298],
]

Au_110_2x1_top = [["Au", 0.0, 0.0, 2.9482596]]
# Au_110_2x1_dict={'bulk' : Au_110_2x1_bulk,'top' : Au_110_2x1_top}


# Au(110)3x1

Au_110_3x1_Lx = 8.3382 / 2.0 * 3.0
Au_110_3x1_Ly = 2.9482596
Au_110_3x1_Lz = 2.9482596
Au_110_3x1_bulk = [
    ["Au", 0.0, 0.0, 0],
    ["Au", 4.1691, 0.0, 0],
    ["Au", 8.3382, 0.0, 0],
    ["Au", 2.08455, 1.474, 1.4741298],
    ["Au", 6.25365, 1.474, 1.4741298],
    ["Au", 10.42275, 1.474, 1.4741298],
]

Au_110_3x1_top = [
    ["Au", 0.0, 0.0, 2.9482596],
    ["Au", 4.1691, 0.0, 2.9482596],
    ["Au", 8.3382, 0.0, 2.9482596],
    ["Au", 2.08455, 1.474, 4.4223894],
    ["Au", 10.42275, 1.474, 4.4223894],
    ["Au", 0.0, 0.0, 5.8965192],
]

# Au(110)4x1

Au_110_4x1_Lx = 8.3382 * 2
Au_110_4x1_Ly = 2.9482596
Au_110_4x1_Lz = 2.9482596
Au_110_4x1_bulk = [
    ["Au", 0.0, 0.0, 0],
    ["Au", 4.1691, 0.0, 0],
    ["Au", 8.3382, 0.0, 0],
    ["Au", 12.5073, 0.0, 0],
    ["Au", 2.08455, 1.474, 1.4741298],
    ["Au", 6.25365, 1.474, 1.4741298],
    ["Au", 10.42275, 1.474, 1.4741298],
    ["Au", 14.59185, 1.474, 1.4741298],
]

Au_110_4x1_top = [
    ["Au", 0.0, 0.0, 2.9482596],
    ["Au", 4.1691, 0.0, 2.9482596],
    ["Au", 12.5073, 0.0, 2.9482596],
    ["Au", 2.08455, 1.474, 4.4223894],
    ["Au", 14.59185, 1.474, 4.4223894],
    ["Au", 0.0, 0.0, 5.8965192],
]

# NaCl(100)
NaCl_100_Lx = 5.6142796  # DZVP-MOLOPT-PBE-GTH-q1 UZH
NaCl_100_Lz = 5.6142796
NaCl_100_top = [
    ["Na", 0.0, 0.0, NaCl_100_Lz],
    ["Na", NaCl_100_Lx / 2, NaCl_100_Lx / 2, NaCl_100_Lz],
    ["Cl", NaCl_100_Lx / 2, 0, NaCl_100_Lz + 0.1],
    ["Cl", 0, NaCl_100_Lx / 2, NaCl_100_Lz + 0.1],
]
NaCl_100_unit = [
    ["Na", 0.0, 0.0, 0],
    ["Na", NaCl_100_Lx / 2, NaCl_100_Lx / 2, 0],
    ["Na", 0, NaCl_100_Lx / 2, NaCl_100_Lz / 2],
    ["Na", NaCl_100_Lx / 2, 0, NaCl_100_Lz / 2],
    ["Cl", NaCl_100_Lx / 2, 0, 0],
    ["Cl", 0, NaCl_100_Lx / 2, 0],
    ["Cl", 0, 0, NaCl_100_Lz / 2],
    ["Cl", NaCl_100_Lx / 2, NaCl_100_Lx / 2, NaCl_100_Lz / 2],
]

slab_lx_ly = {
    "Au-herringbone": [au_h_x, au_h_y],
    "Au(111)": [au_x, au_y],
    "Au(110)2x1": [Au_110_2x1_Lx, Au_110_2x1_Ly],
    "Au(110)3x1": [Au_110_3x1_Lx, Au_110_3x1_Ly],
    "Au(110)4x1": [Au_110_4x1_Lx, Au_110_4x1_Ly],
    "Cu(110)O-2x1": [Cu_110_O_2x1_Lx, Cu_110_O_2x1_Ly],
    "Ag(111)": [ag_x, ag_y],
    "Cu(111)": [cu_x, cu_y],
    "NaCl(100)": [NaCl_100_Lx, NaCl_100_Lx],
    "PdGa_A_Pd1": [PdGa_Lx, PdGa_Ly],
    "PdGa_A_Pd3": [PdGa_Lx, PdGa_Ly],
    "hBN": [h_bn_x, h_bn_y],
}


def guess_slab_size(mol, which_surf):
    cx = np.amax(mol.positions[:, 0]) - np.amin(mol.positions[:, 0]) + 12
    cy = np.amax(mol.positions[:, 1]) - np.amin(mol.positions[:, 1]) + 12
    nx = int(round(cx / slab_lx_ly[which_surf][0])) + 1
    ny = int(round(cy / slab_lx_ly[which_surf][1])) + 1
    return nx, ny


def prepare_slab(mol, dx, dy, dz, phi, nx, ny, nz, which_surf):
    # Au(111) herringbone
    if "Au-herringbone" in which_surf:
        auh = ase.Atoms()
        currentz = 10.0 + dz_au_h + nz * dz_au_bulk
        finalz = currentz
        iz = 0
        for iz in range(nz):
            currentz -= dz_au_bulk
            xy_index = iz % 3 + 1
            for au in au_h[xy_index]:
                auh.append(ase.Atom("Au", (au[0], au[1], currentz)))
        # Add H layer
        currentz -= dz_au_h
        iz += 1
        xy_index = iz % 3 + 1
        for au in au_h[xy_index]:
            auh.append(ase.Atom("H", (au[0], au[1], currentz)))
        # Add top layer, z starts from 18,must subtract
        for au in au_h_top:
            auh.append(
                ase.Atom(
                    "Au",
                    (au[0], au[1], au[2] - dz_au_h - 10.0 - 3 * dz_au_bulk + finalz),
                )
            )

        auh.cell = (au_h_x, au_h_y, finalz + 3 * dz_au_bulk + 2.9482596 + 40.0)
        auh.pbc = (True, True, True)
        # Replicate by nx and ny
        the_slab = auh.repeat((nx, ny, 1))
        slab_z_max = np.max(the_slab.positions[:, 2])

        cx, cy, cz = the_slab.cell.diagonal()

    # Au(110)2x1 SECTION
    elif "Au(110)2x1" in which_surf:
        au = ase.Atoms()
        for a in Au_110_2x1_bulk:
            au.append(ase.Atom(a[0], (float(a[1]), float(a[2]), float(a[3]))))
        au.cell = (Au_110_2x1_Lx, Au_110_2x1_Ly, Au_110_2x1_Lz)
        au.pbc = (True, True, True)
        # Build 1x1xnz bulk
        au = au.repeat((1, 1, nz))

        # Add top layer
        for a in Au_110_2x1_top:
            au.append(
                ase.Atom(
                    a[0],
                    (float(a[1]), float(a[2]), float(a[3]) + (nz - 1) * Au_110_2x1_Lz),
                )
            )

        # Add to cell thickness of bulk part + vacuum
        au.cell = (Au_110_2x1_Lx, Au_110_2x1_Ly, nz * Au_110_2x1_Lz + 2.9482596 + 40.0)

        # replicate by nx and ny
        au = au.repeat((nx, ny, 1))
        the_slab = sort(au, tags=au.get_positions()[:, 2] * -1)
        the_slab.positions += np.array((0, 0, 10))
        slab_z_max = np.max(the_slab.positions[:, 2])

        cx, cy, cz = the_slab.cell.diagonal()

    # Au(110)3x1 SECTION
    elif "Au(110)3x1" in which_surf:
        au = ase.Atoms()
        for a in Au_110_3x1_bulk:
            au.append(ase.Atom(a[0], (float(a[1]), float(a[2]), float(a[3]))))
        au.cell = (Au_110_3x1_Lx, Au_110_3x1_Ly, Au_110_3x1_Lz)
        au.pbc = (True, True, True)
        # build 1x1xnz bulk
        au = au.repeat((1, 1, nz))

        # Add top layer
        for a in Au_110_3x1_top:
            au.append(
                ase.Atom(
                    a[0],
                    (float(a[1]), float(a[2]), float(a[3]) + (nz - 1) * Au_110_3x1_Lz),
                )
            )

        # Add to cell thickness of bulk part + vacuum
        au.cell = (Au_110_3x1_Lx, Au_110_3x1_Ly, nz * Au_110_3x1_Lz + 2.9482596 + 40.0)

        # Replicate by nx and ny
        au = au.repeat((nx, ny, 1))
        the_slab = sort(au, tags=au.get_positions()[:, 2] * -1)
        the_slab.positions += np.array((0, 0, 10))
        slab_z_max = np.max(the_slab.positions[:, 2])

        cx, cy, cz = the_slab.cell.diagonal()

    # Au(110)4x1 SECTION.
    elif "Au(110)4x1" in which_surf:
        au = ase.Atoms()
        for a in Au_110_4x1_bulk:
            au.append(ase.Atom(a[0], (float(a[1]), float(a[2]), float(a[3]))))
        au.cell = (Au_110_4x1_Lx, Au_110_4x1_Ly, Au_110_4x1_Lz)
        au.pbc = (True, True, True)
        # build 1x1xnz bulk
        au = au.repeat((1, 1, nz))

        # Add top layer.
        for a in Au_110_4x1_top:
            au.append(
                ase.Atom(
                    a[0],
                    (float(a[1]), float(a[2]), float(a[3]) + (nz - 1) * Au_110_4x1_Lz),
                )
            )

        # Add to cell thickness of bulk part + vacuum
        au.cell = (Au_110_4x1_Lx, Au_110_4x1_Ly, nz * Au_110_4x1_Lz + 2.9482596 + 40.0)

        # Replicate by nx and ny.
        au = au.repeat((nx, ny, 1))
        the_slab = sort(au, tags=au.get_positions()[:, 2] * -1)
        the_slab.positions += np.array((0, 0, 10))
        slab_z_max = np.max(the_slab.positions[:, 2])

        cx, cy, cz = the_slab.cell.diagonal()

    # Cu(110)O-2x1 SECTION.
    elif "Cu(110)O-2x1" in which_surf:
        cu = ase.Atoms()
        for a in Cu_110_O_2x1_bulk:
            cu.append(ase.Atom(a[0], (float(a[1]), float(a[2]), float(a[3]))))
        cu.cell = (Cu_110_O_2x1_Lx, Cu_110_O_2x1_Ly, Cu_110_O_2x1_Lz)
        cu.pbc = (True, True, True)
        #  Build 1x1xnz bulk.
        cu = cu.repeat((1, 1, nz))

        # Add top layer.
        for a in Cu_110_O_2x1_top:
            cu.append(
                ase.Atom(
                    a[0],
                    (
                        float(a[1]),
                        float(a[2]),
                        float(a[3]) + (nz - 1) * Cu_110_O_2x1_Lz,
                    ),
                )
            )

        # Add to cell thickness of bulk part + vacuum.
        cu.cell = (
            Cu_110_O_2x1_Lx,
            Cu_110_O_2x1_Ly,
            nz * Cu_110_O_2x1_Lz + 2.54631563 + 40.0,
        )

        # Replicate by nx and ny.
        cu = cu.repeat((nx, ny, 1))
        the_slab = sort(cu, tags=cu.get_positions()[:, 2] * -1)
        the_slab.positions += np.array((0, 0, 10))
        slab_z_max = np.max(the_slab.positions[:, 2])

        cx, cy, cz = the_slab.cell.diagonal()

    # PdGa SECTION.
    elif "PdGa_A_Pd" in which_surf:
        pdga = ase.Atoms()
        for a in PdGa_dict[which_surf]["bulk"]:
            pdga.append(ase.Atom(a[0], (float(a[1]), float(a[2]), float(a[3]))))
        pdga.cell = (PdGa_Lx, PdGa_Ly, PdGa_Lz)
        pdga.pbc = (True, True, True)
        # build 1x1xnz bulk
        pdga = pdga.repeat((1, 1, nz))

        # Add top layers with Pd3 termination.
        for a in PdGa_dict[which_surf]["top"]:
            pdga.append(
                ase.Atom(
                    a[0], (float(a[1]), float(a[2]), float(a[3]) + (nz - 1) * PdGa_Lz)
                )
            )

        # Add to cell thickness of Pd3 part + vacuum.
        pdga.cell = (PdGa_Lx, PdGa_Ly, nz * PdGa_Lz + 7.287373901153 + 40.0)

        # Replicate by nx and ny.
        pd3 = pdga.repeat((nx, ny, 1))
        the_slab = sort(pd3, tags=pd3.get_positions()[:, 2] * -1)
        the_slab.positions += np.array((0, 0, 10))
        slab_z_max = np.max(the_slab.positions[:, 2])

        cx, cy, cz = the_slab.cell.diagonal()
    # hBN
    elif which_surf == "hBN":
        hbn = ase.Atoms()
        for a in h_bn_unit:
            hbn.append(
                ase.Atom(
                    a[0],
                    (float(a[1]) * h_bn_x, float(a[2]) * h_bn_y, float(a[3]) * h_bn_z),
                )
            )
        hbn.cell = (h_bn_x, h_bn_y, h_bn_z)
        hbn.pbc = (True, True, True)
        # build nx x ny x nz bulk
        hbn = hbn.repeat((nx, ny, nz))

        # Add to cell vacuum.
        hbn.cell = (h_bn_x * nx, h_bn_y * ny, h_bn_z * nz + 40.0)
        the_slab = sort(hbn, tags=hbn.get_positions()[:, 2] * -1)
        the_slab.positions += np.array((0, 0, 10))
        slab_z_max = np.max(the_slab.positions[:, 2])

        cx, cy, cz = the_slab.cell.diagonal()
    # NaCl(100)
    elif which_surf == "NaCl(100)":
        nacl = ase.Atoms()
        for a in NaCl_100_unit:
            nacl.append(
                ase.Atom(
                    a[0],
                    (
                        float(a[1]),
                        float(a[2]),
                        float(a[3]),
                    ),
                )
            )
        nacl.cell = (NaCl_100_Lx, NaCl_100_Lx, NaCl_100_Lz)
        nacl.pbc = (True, True, True)
        # build a 1 x 1 x nz bulk
        nacl = nacl.repeat((1, 1, nz))
        nacl.cell = (NaCl_100_Lx, NaCl_100_Lx, NaCl_100_Lz * nz + 40.0)
        # Add top layers with NaCl termination.
        for a in NaCl_100_top:
            nacl.append(
                ase.Atom(
                    a[0],
                    (float(a[1]), float(a[2]), float(a[3]) + (nz - 1) * NaCl_100_Lz),
                )
            )
        # replicate nx x ny
        nacl = nacl.repeat((nx, ny, 1))

        # Add to cell vacuum.
        nacl.cell = (NaCl_100_Lx * nx, NaCl_100_Lx * ny, NaCl_100_Lz * nz + 40.0)
        the_slab = sort(nacl, tags=nacl.get_positions()[:, 2] * -1)
        the_slab.positions += np.array((0, 0, 10))
        slab_z_max = np.max(the_slab.positions[:, 2])

        cx, cy, cz = the_slab.cell.diagonal()
    # NOBLE metals (111).
    else:
        if which_surf == "Au(111)":
            lx = au_x
            ly = au_y
            dz_bulk = dz_au_bulk
            dz_h = dz_au_h
            dz_2_3 = dz_au_2_3
            dz_1_2 = dz_au_1_2
            exact_xz = au_exact_xz
            ida = 79
        elif which_surf == "Ag(111)":
            lx = ag_x
            ly = ag_y
            dz_bulk = dz_ag_bulk
            dz_h = dz_ag_h
            dz_2_3 = dz_ag_2_3
            dz_1_2 = dz_ag_1_2
            exact_xz = ag_exact_xz
            ida = 47
        elif which_surf == "Cu(111)":
            lx = cu_x
            ly = cu_y
            dz_bulk = dz_cu_bulk
            dz_h = dz_cu_h
            dz_2_3 = dz_cu_2_3
            dz_1_2 = dz_cu_1_2
            exact_xz = cu_exact_xz
            ida = 29

        # Build up the unit cell of the gold slab with nz Au layers
        the_slab = []
        layer_z = 10.0
        # H layer in au lattice x-y positions
        the_slab.append([1, exact_xz[0, 0, 0], exact_xz[0, 0, 1], layer_z])
        the_slab.append([1, exact_xz[0, 1, 0], exact_xz[0, 1, 1], layer_z])
        # nz bulk layers
        for i in range(nz):
            if i == 0:
                layer_z += dz_h
            elif i == nz - 2:
                layer_z += dz_2_3
            elif i == nz - 1:
                layer_z += dz_1_2
            else:
                layer_z += dz_bulk
            xy_pos = exact_xz[(i + 1) % 3]
            the_slab.append([ida, xy_pos[0, 0], xy_pos[0, 1], layer_z])
            the_slab.append([ida, xy_pos[1, 0], xy_pos[1, 1], layer_z])

        the_slab = np.array(the_slab)

        # determine cell size
        vac_size = 40.0
        slab_z_max = np.max(the_slab[:, 3])
        slab_z_extent = slab_z_max - np.min(the_slab[:, 3])

        cz = slab_z_extent + vac_size
        cx = nx * lx
        cy = ny * ly

        # generate gold slab based on the rectangular unit cell
        the_slab_raw = []
        for i in range(nx):
            for j in range(ny):
                shift = np.array([0, i * lx, j * ly, 0])
                the_slab_raw.append(the_slab + shift)

        the_slab_raw = np.concatenate(the_slab_raw)
        the_slab = ase.Atoms(numbers=the_slab_raw[:, 0], positions=the_slab_raw[:, 1:])
        the_slab = sort(the_slab, tags=the_slab.get_positions()[:, 2] * -1)

    # print("Cell ABC: %f, %f, %f"%(cx, cy, cz))
    # print("#atoms: %d"%(len(the_slab)))

    # rotate molecule
    mol.rotate(phi, "z")

    mol.cell = (cx, cy, cz)
    mol.pbc = (True, True, True)

    # position molecule a bit above gold slab
    min_mol_slab_dist = 2.3
    avg_mol_slab_dist = 3.2

    mol.center()
    mol_z_min = np.min(mol.positions[:, 2])
    mol_z_avg = np.mean(mol.positions[:, 2])

    min_shift = slab_z_max - mol_z_min + min_mol_slab_dist
    avg_shift = slab_z_max - mol_z_avg + avg_mol_slab_dist

    mol.positions[:, 2] += np.max([min_shift, avg_shift])

    # translate molecule
    mol.positions += np.array([dx, dy, dz])

    return the_slab
